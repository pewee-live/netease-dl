<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>éŸ³ä¹ Â· ä¿¡æ¯å±•ç¤º</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        section { margin-bottom: 30px; }
        input, button, select { padding: 5px; margin: 5px; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 5px 0; border-bottom: 1px solid #ccc; }
        .tabs {
		  font-family: Arial, sans-serif;
		  width: 90%;
		  max-width: 900px;
		  margin: 20px auto;
		}
		
		.tab-nav {
		  display: flex;
		  border-bottom: 2px solid #ccc;
		  margin-bottom: 1em;
		}
		
		.tab-link {
		  background: none;
		  border: none;
		  padding: 10px 20px;
		  cursor: pointer;
		  font-size: 16px;
		  border-bottom: 3px solid transparent;
		  transition: border-color 0.3s;
		}
		
		.tab-link:hover {
		  border-bottom-color: #888;
		}
		
		.tab-link.active {
		  font-weight: bold;
		  border-bottom-color: #007bff;
		  color: #007bff;
		}
		
		.tab-content {
		  display: none;
		}
		
		.tab-content.active {
		  display: block;
		}

    </style>
</head>
<body>
    <h2>ğŸµ ç½‘æ˜“äº‘éŸ³ä¹ Â· ä¸‹è½½å™¨</h2>
    
    <div id="title">é¡¹ç›®åœ°å€:https://github.com/pewee-live/netease-dl</div>

	<div class="tabs">
		<nav class="tab-nav">
		    <button class="tab-link active" data-tab="tab-playlist">æ­Œå•</button>
		    <button class="tab-link" data-tab="tab-album">ä¸“è¾‘</button>
		    <button class="tab-link" data-tab="tab-search">æœç´¢</button>
	  </nav>
	  
	  <div id="tab-playlist" class="tab-content active">
	    <h3>æˆ‘çš„æ­Œå• & æŸ¥çœ‹æ­Œå•è¯¦æƒ…</h3>
	    <!-- è¿™é‡Œæ”¾æˆ‘çš„æ­Œå•å’Œæ­Œå•è¯¦æƒ…å†…å®¹ -->
	    <!-- ä¾‹å¦‚ï¼šè¾“å…¥æ­Œå•IDã€åŠ è½½æ­Œå•æŒ‰é’®ã€æ­Œå•è¯¦æƒ…åˆ—è¡¨ç­‰ -->
	    <!-- ç”¨æˆ·æ­Œå• -->
	    <section>
	        <h3>1. æˆ‘çš„æ­Œå•</h3>
	        <button onclick="loadMyPlaylists()">åŠ è½½æ­Œå•</button>
	        <ul id="playlist-list"></ul>
	    </section>
	    
		<section>
		    <h3>2. æŸ¥çœ‹æ­Œå•è¯¦æƒ…</h3>
		    <input type="text" id="playlistId" placeholder="è¾“å…¥æ­Œå• ID">
		    <button onclick="loadPlaylistDetail()">æŸ¥çœ‹è¯¦æƒ…</button>
		    <div id="playlist-info"></div>
		    <ul id="playlist-tracks"></ul>
		    <div id="playlist-pagination">
		        <button id="prev-page" onclick="changePage(-1)" disabled>ä¸Šä¸€é¡µ</button>
		        <span id="page-indicator">ç¬¬ 1 é¡µ</span>
		        <button id="next-page" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
		    </div>
		</section>
		
		<!-- æ­Œæ›²ä¿¡æ¯ -->
	    <section>
	        <h3>3. æŸ¥çœ‹æ­Œæ›²ä¿¡æ¯</h3>
	        <input type="text" id="songId" placeholder="æ­Œæ›² ID">
	        <select id="songLevel">
	            <option value="standard">standard</option>
	            <option value="exhigh">exhigh</option>
	            <option value="lossless">lossless</option>
	        </select>
	        <button onclick="loadSongInfo()">æŸ¥çœ‹æ­Œæ›²</button>
	        <div id="song-info"></div>
	    </section>
		
	  </div>
	  
	  <div id="tab-album" class="tab-content">
	    <h3>æŸ¥çœ‹ä¸“è¾‘ä¿¡æ¯</h3>
	    <!-- è¿™é‡Œæ”¾æŸ¥çœ‹ä¸“è¾‘çš„å†…å®¹ -->
	        <!-- ä¸“è¾‘ä¿¡æ¯ -->
	    <section>
	        <input type="text" id="albumId" placeholder="è¾“å…¥ä¸“è¾‘ ID">
	        <button onclick="loadAlbumInfo()">æŸ¥çœ‹ä¸“è¾‘</button>
	        <div id="album-info">
			    <p><strong>ä¸“è¾‘åï¼š</strong> <span id="album-name"></span></p>
			    <p><strong>æ­Œæ‰‹ï¼š</strong> <span id="album-artist"></span></p>
			    <p><strong>å‘è¡Œæ—¶é—´ï¼š</strong> <span id="album-publish-time"></span></p>
			    <p><strong>å°é¢ï¼š</strong> <img id="album-cover" style="max-width: 200px;"></p>
			    <h4>æ­Œæ›²åˆ—è¡¨ï¼š</h4>
			    <ul id="album-tracks"></ul>
		  	</div>
	    </section>
	  </div>
	
	  <div id="tab-search" class="tab-content">
	    <h3>æœç´¢</h3>
	    <section>
	        <input type="text" id="searchKeyword" placeholder="å…³é”®è¯">
	        <button onclick="searchSongs()">æœç´¢</button>
	        <ul id="search-results"></ul>
	    </section>
	  </div>
	</div>
	  

    <script>
    	document.querySelectorAll(".tab-link").forEach(button => {
		  button.addEventListener("click", () => {
		    const tabId = button.getAttribute("data-tab");
		
		    // ç§»é™¤æ‰€æœ‰tab-link activeæ ·å¼
		    document.querySelectorAll(".tab-link").forEach(btn => btn.classList.remove("active"));
		    // éšè—æ‰€æœ‰tab-content
		    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
		
		    // æ¿€æ´»å½“å‰tabæŒ‰é’®
		    button.classList.add("active");
		    // æ˜¾ç¤ºå¯¹åº”å†…å®¹
		    document.getElementById(tabId).classList.add("active");
		  });
		});

    	
    	
    	
        function loadMyPlaylists() {
   			 axios.post('/MyPlaylist')
		        .then(resp => {
		            const list = document.getElementById("playlist-list");
		            list.innerHTML = '';
		            const playlists = resp.data.data.playlists; // âœ… æ­£ç¡®è®¿é—® playlists å­—æ®µ
		            playlists.forEach(pl => {
		                const li = document.createElement("li");
		                li.innerText = `${pl.name}ï¼ˆå…± ${pl.trackCount} é¦–æ­Œï¼‰ ID: ${pl.id}`;
		                list.appendChild(li);
		            });
		        })
		        .catch(err => alert("åŠ è½½å¤±è´¥ï¼š" + err));
		}
		
		
		
		let allTracks = [];
		let currentPage = 1;
		const pageSize = 50;
		
		function loadPlaylistDetail() {
		    const id = document.getElementById("playlistId").value;
		    if (!id) {
		        alert("è¯·è¾“å…¥æ­Œå•ID");
		        return;
		    }
		
		    axios.post('/Playlist', new URLSearchParams({ id }))
		        .then(resp => {
		            if (resp.data.code !== "000000") {
		                throw new Error(resp.data.msg || "æœåŠ¡å¼‚å¸¸");
		            }
		
		            const playlist = resp.data.data.playlist;
		            allTracks = playlist.tracks || [];
		            currentPage = 1;
		
		            // æ˜¾ç¤ºæ­Œå•åŸºæœ¬ä¿¡æ¯
		            const infoDiv = document.getElementById("playlist-info");
		            infoDiv.innerHTML = `
		                <h3>æ­Œå•è¯¦æƒ…ï¼š${playlist.name}</h3>
		                <button onclick="downloadPlaylist(${playlist.id})">ä¸‹è½½æ•´ä¸ªæ­Œå•</button><br/>
		                <img src="${playlist.coverImgUrl}" alt="å°é¢" width="200"/><br/>
		                <strong>åˆ›å»ºäººï¼š</strong>${playlist.creator}<br/>
		                <strong>æè¿°ï¼š</strong>${playlist.description || 'æ— '}<br/>
		                <strong>å…± ${playlist.trackCount} é¦–æ­Œ</strong>
		            `;
		
		            renderTracksPage();
		        })
		        .catch(error => {
		            console.error("åŠ è½½æ­Œå•è¯¦æƒ…å¤±è´¥ï¼š", error);
		            alert("åŠ è½½æ­Œå•è¯¦æƒ…å¤±è´¥ï¼š" + error.message);
		        });
		}
		
		function renderTracksPage() {
		    const list = document.getElementById("playlist-tracks");
		    const start = (currentPage - 1) * pageSize;
		    const end = start + pageSize;
		    const pageTracks = allTracks.slice(start, end);
		
		    if (pageTracks.length === 0) {
		        list.innerHTML = "<li>è¯¥é¡µæš‚æ— æ­Œæ›²</li>";
		        return;
		    }
		
		    list.innerHTML = pageTracks.map(t =>
		        `<li><strong>${t.name}</strong> - ${t.artists}ï¼ˆID: ${t.id}ï¼‰</li>`
		    ).join('');
		
		    // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
		    document.getElementById("page-indicator").textContent = `ç¬¬ ${currentPage} é¡µ`;
		    document.getElementById("prev-page").disabled = currentPage === 1;
		    document.getElementById("next-page").disabled = end >= allTracks.length;
		}
		
		function changePage(offset) {
		    const newPage = currentPage + offset;
		    if (newPage < 1 || (newPage - 1) * pageSize >= allTracks.length) {
		        return;
		    }
		    currentPage = newPage;
		    renderTracksPage();
		}

		function loadAlbumInfo() {
		    const albumId = document.getElementById("albumId").value;
		    fetch(`/Album?id=${albumId}`)
		        .then(res => res.json())
		        .then(resp => {
		            if (resp.code !== '000000') {
		                alert("åŠ è½½ä¸“è¾‘å¤±è´¥ï¼š" + resp.msg);
		                return;
		            }
		
		            const album = resp.data.album;
		
		            // æ¸²æŸ“åŸºç¡€ä¿¡æ¯
		            document.getElementById("album-name").innerText = album.name;
		            document.getElementById("album-artist").innerText = album.artist;
		            document.getElementById("album-publish-time").innerText =
		                new Date(album.publishTime).toLocaleDateString();
		            document.getElementById("album-cover").src = album.coverImgUrl;
		
		            // æ¸²æŸ“æ­Œæ›²åˆ—è¡¨
		            const tracksList = document.getElementById("album-tracks");
		            tracksList.innerHTML = "";
		            album.songs.forEach(track => {
		                const li = document.createElement("li");
		                li.textContent = `${track.name} - ${track.artists}ï¼ˆID: ${track.id}ï¼‰`;
		                tracksList.appendChild(li);
		            });
		            document.getElementById("album-info").innerHTML += `
					    <button onclick="downloadAlbum(${album.id})">ä¸‹è½½æ•´ä¸ªä¸“è¾‘</button>
					`;
		        })
		        .catch(err => {
		            alert("åŠ è½½ä¸“è¾‘å¤±è´¥ï¼š" + err);
		        });
		}
				
		
        function loadSongInfo() {
			const songId = document.getElementById('songId').value;
  			const level = document.getElementById('songLevel').value;
	
			  if (!songId) {
			    alert('è¯·è¾“å…¥æ­Œæ›²ID');
			    return;
			  }
		  fetch(`/Song_V1?id=${songId}&level=${level}`)
		    .then(res => res.json())
		    .then(data => {
		      if (data.code === "000000" && data.data) {
		        const song = data.data; // å•ä¸ªæ­Œæ›²å¯¹è±¡
		        // æ˜¾ç¤ºæ­Œæ›²ä¿¡æ¯ç¤ºèŒƒ
		        const container = document.getElementById('song-info');
		        container.innerHTML = `
		          <h3>æ­Œæ›²è¯¦æƒ…</h3>
		          	<button onclick="downloadSingle(${song.id})">ä¸‹è½½</button><br/>
			        <p><strong>æ­Œæ›²åï¼š</strong> ${song.name}</p>
			        <p><strong>æ–‡ä»¶å¤§å°ï¼š</strong> ${song.size}</p>
			        <p><strong>æ­Œæ›²å›¾ç‰‡ï¼š</strong></p>
			        <p><strong>ä¸“è¾‘åï¼š</strong> ${song.al_name}</p>
			        <p><strong>æ­Œæ‰‹åï¼š</strong> ${song.ar_name}</p>
			        <p><strong>æ­Œè¯ï¼š</strong></p>
			        <pre>${song.lyric || 'æ— æ­Œè¯'}</pre>
			        <p><strong>ç¿»è¯‘æ­Œè¯ï¼š</strong></p>
			        <pre>${song.tlyric || 'æ— ç¿»è¯‘æ­Œè¯'}</pre>
		        `;
		      } else {
		        alert("åŠ è½½æ­Œæ›²å¤±è´¥!");
		      }
		    })
		    .catch(err => alert("åŠ è½½æ­Œæ›²å¤±è´¥ï¼š" + err));
		}

        function searchSongs() {
            const kw = document.getElementById("searchKeyword").value;
            if (!kw) return alert("è¯·è¾“å…¥å…³é”®è¯");
            axios.post(`/Search?keywords=${encodeURIComponent(kw)}`)
                .then(resp => {
                    const list = document.getElementById("search-results");
                    list.innerHTML = '';
                    resp.data.data.forEach(song => {
                        const li = document.createElement("li");
                        li.innerText = `${song.name} - ${song.artists}ï¼ˆID : ${song.id}ï¼‰`;
                        list.appendChild(li);
                    });
                })
                .catch(err => alert("æœç´¢å¤±è´¥ï¼š" + err));
        }
        
        function downloadSingle(id) {
		    axios.get(`/v2/single?id=${id}`)
		        .then(() => alert("å•æ›²ä¸‹è½½ä»»åŠ¡å·²æäº¤"))
		        .catch(err => alert("å•æ›²ä¸‹è½½å¤±è´¥ï¼š" + err));
		}
		
		function downloadPlaylist(id) {
		    axios.get(`/v2/playlist?id=${id}`)
		        .then(() => alert("æ­Œå•ä¸‹è½½ä»»åŠ¡å·²æäº¤"))
		        .catch(err => alert("æ­Œå•ä¸‹è½½å¤±è´¥ï¼š" + err));
		}
		
		function downloadAlbum(id) {
		    axios.get(`/v2/album?id=${id}`)
		        .then(() => alert("ä¸“è¾‘ä¸‹è½½ä»»åŠ¡å·²æäº¤"))
		        .catch(err => alert("ä¸“è¾‘ä¸‹è½½å¤±è´¥ï¼š" + err));
		}
    </script>
</body>
</html>
